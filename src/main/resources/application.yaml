# SERVER CONFIGURATION
server:
  port: 8080
  servlet:
    context-path: /spot

# SPRING CONFIGURATION
spring:

# VIRTUAL THREADS CONFIGURATION
  threads:
    virtual:
      enabled: true

# SPRING CLOUD CONFIGURATION
  cloud:
    function:
      definition: orderCreatedListener;orderProcessedListenerLegacy;orderProcessedListenerNew
    stream:
      bindings:
        orderCreatedProducer-out-0:
          destination: order-created-legacy
          binder: kafka-legacy
        orderCreatedProducer-out-1:
          destination: order-created
          binder: kafka-new
        orderCreatedListener-in-0:
          destination: order-created-legacy
          group: spot
          binder: kafka-legacy
        orderCreatedListener-in-1:
          destination: order-created
          group: spot
          binder: kafka-new
        orderCreatedListener-out-0:
          destination: order-processed-legacy
          binder: kafka-legacy
        orderCreatedListener-out-1:
          destination: order-processed
          binder: kafka-new
        orderProcessedListenerLegacy-in-0:
          destination: order-processed-legacy
          group: spot
          binder: kafka-legacy
        orderProcessedListenerNew-in-0:
          destination: order-processed
          group: spot
          binder: kafka-new
      kafka:
        binder:
          auto-create-topics: true
          configuration:
            security:
              protocol: SASL_PLAINTEXT
            sasl:
              mechanism: PLAIN
        bindings:
          orderCreatedListener-in-0:
            consumer:
              enableDlq: true
              dlqName: order-created-legacy-dlt
              autoCommitOnError: true
              autoCommitOffset: true
          orderCreatedListener-in-1:
            consumer:
              enableDlq: true
              dlqName: order-created-dlt
              autoCommitOnError: true
              autoCommitOffset: true
          orderProcessedListenerLegacy-in-0:
            consumer:
              enableDlq: true
              dlqName: order-processed-legacy-dlt
              autoCommitOnError: true
              autoCommitOffset: true
          orderProcessedListenerNew-in-0:
            consumer:
              enableDlq: true
              dlqName: order-processed-dlt
              autoCommitOnError: true
              autoCommitOffset: true
      default-binder: kafka-new
      binders:
        kafka-legacy:
          type: kafka
          environment:
            spring:
              cloud:
                stream:
                  kafka:
                    binder:
                      brokers: localhost:9092
                      configuration:
                        sasl:
                          jaas:
                            config: "org.apache.kafka.common.security.plain.PlainLoginModule required username=\"spot\" password=\"spot\";"
        kafka-new:
          type: kafka
          environment:
            spring:
              cloud:
                stream:
                  kafka:
                    binder:
                      brokers: localhost:9093
                      configuration:
                        sasl:
                          jaas:
                            config: "org.apache.kafka.common.security.plain.PlainLoginModule required username=\"spot\" password=\"spot\";"
